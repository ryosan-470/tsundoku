# Testing on the Toilet: What Makes a Good End-to-End Test?

https://testing.googleblog.com/2016/09/testing-on-toilet-what-makes-good-end.html


エンドツーエンドテストでは、システム全体を一方の端からもう一方の端までテストをし、その間にあるすべてのものをブラックボックスとして扱います。**エンドツーエンドは、システム全体に渡る明白なバグを見つけ出すことができます。** 更に単体テストと統合テストに加えて、これらはバランスの取れたテストのダイエットの重要な部分であり、運用に近い状態でシステムの健全性について信頼を提供します。残念ながら、エンドツーエンドテストは、単体テストや統合テストと比較して**遅く、剥がれやすく、維持することが大変であるものです**。エンドツーエンドテストが正当化されるかどうか、そしてそうならどのようにテストを書くことが最善であるかを慎重に検討してみてください。

それでは、「ログインフロー」を例にエンドツーエンドテストがどのように動くかを考えてみましょう。

![](https://1.bp.blogspot.com/-XpDz-avnNhA/V-LBGc9cvtI/AAAAAAAAAOQ/FuzdVujJW8EOTzSUZ0rbUPeg2U2VJh2QgCLcB/s1600/image00.png)


コストを効果的にするためには、エンドツーエンドテストは、リソース配分や並行性の問題、APIの互換性といった**小さなテストでは信頼性が評価できないシステムの側面に焦点を**合わせるべきです。具体的には、

- **重要なユースケースごとに対応するエンドツーエンドテストがあるべきです** これには重要なクラスのエラーもそれぞれ含むべきでしょう。目標はエンドツーエンドの合計数を少なくすることです。
- 遅くて不安定な依存関係や軽微なUI変更といった問題に直面しても、エンドツーエンドテストを安定化させるために**テストごとに少なくとも1週間を割り当ててください** 
- **具体的な実装の詳細ではなく、システム全体の動作を確認することに集中してください** 例えば、ログインの振る舞いについてテストをしているときは、頻繁に変わる可能性のあるう正確なメッセージや視覚的なレイアウトに関係なく、プロセスが成功することを確認します。
- 概要レベルのログファイルを提供し、一般的なテスト失敗モードを文書化し、関連するすべてのシステム状態情報(スクリーンショット、データベーススナップショットなど) を保存することで**エンドツーエンドテストをデバッグしやすいようにします** 

エンドツーエンドテストにはいくつか重要な注意点があります。

- 他のチームが所有しているシステムのコンポーネントは予想外に変更されテストが破壊されます。これは全体的なメンテナンスコストを増加させますが、互換性のない変更を強調することができます。
- **エンドツーエンドテストを完全に気密にすることは難しいかもしれません** 残ったテストデータは将来のテストや本番のシステムを変更するかもしれません。可能であればテストデータを短期間だけ保持するようにしてください。
- エンドツーエンドテストでは、基礎となる依存関係のために複数のテスト ([fakeかstub](https://testing.googleblog.com/2013/07/testing-on-toilet-know-your-test-doubles.html)) が必要になることがよくあります。ただし時間の経過とともに実際の実装から変わっていくためメンテナンスの負担が大きくなる可能性があります。

