# Testing on the Toilet: Don't Put Logic in Tests

https://testing.googleblog.com/2014/07/testing-on-toilet-dont-put-logic-in.html


プログラミング言語は多くの表現力を兼ね備えています。演算子と条件分岐は最も重要なツールであり、プログラムを書く際に幅広い入力に対応することができるようになります。けれどもこの柔軟性は複雑性を増加させ、プログラムを理解することをより困難にしていきます。

プロダクションコードと違い、**テストでは柔軟性よりも簡潔さが大切になります**。ほとんどのユニットテストは単一のわかっている入力が単一の出力をするという検証をします。**テストは入力と出力を直接書くことにより、それらを算出することよりもはるかに複雑性を排除することができます。** 

単純な例を見てみましょう。このテストはあなたにとって正しいものに思えますか?

```java
    @Test public void shouldNavigateToPhotosPage() {
      String baseUrl = "http://plus.google.com/";
      Navigator nav = new Navigator(baseUrl);
      nav.goToPhotosPage();
      assertEquals(baseUrl + "/u/0/photos", nav.getCurrentUrl());
    }
```

書いた人は変数に共通するプレフィックスを保存することで重複を避けるようにしたことがわかります。単一文字列を結合することはとても悪いことには見えませんが、変数をインライン化してテストを簡素化するとどうなりますか?


```java
    @Test public void shouldNavigateToPhotosPage() {
      Navigator nav = new Navigator("http://plus.google.com/");
      nav.goToPhotosPage();
      assertEquals("http://plus.google.com//u/0/photos", nav.getCurrentUrl()); // Oops!
    }
```

**不必要な計算をテストから排除すると、バグが明白になります** URLに2つのスラッシュを追加しようとしていたのです。このテストは落ちるか、(最も最悪の場合は) 間違って通ってしまい、本番コードでも同じバグを引き起こします。入力と出力を計算しようとするのではなく直接記述した場合、これを書くようなことはなかったでしょう。そしてこれはとても簡単な例で、**テストにさらに演算子を追加したりループや条件分岐が入ってくると自信をもってこれは正しいということが難しくなってくるでしょう** 

別の言い方をすれば、本番のコードは入力が与えられた場合の出力を計算するための一般的な戦略を説明していますが、テストは入力/出力の具体的なペアです。(出力には他のクラスとの相互作用の検証などといった副作用が含まれる場合があります)

入力/出力のペアがただしいかどうかを伝えることはたとえロジックが複雑な計算を必要とする場合でも常に容易です。たとえば、特定のサーバー応答に対してJavaScript関数によって作成される正確なDOMを想像することは困難です。そのため、そのような関数に対する理想的なテストでは出力に期待されるHTMLが文字列に含まれるかを比較します。

**テスト独自のロジックが必要な場合、そのようなロジックはテスト本体からユーティリティおよびヘルパー関数に移動する必要があります**。そのようなヘルパーは非常に複雑になる可能性があるため、通常重要なテストユーティリティには独自のテストを用意することをおすすめします。


