---
title: "Increasing access to blockchain and ledger databases"
date: 2019-11-24T18:34:01+09:00
draft: false
tags: ["aws", "blockchain"]
---

# Increasing access to blockchain and ledger databases

昨年、HARAというジャカルタにあるAWSの顧客を訪問しました。彼らは発展途上国で種子や肥料、道具といったものの配給業者や銀行と小さな農家をつなぐものを作っています。伝統的に田舎の農家は口座開設やクレジット申請に必要な情報を通常持っていないため、金融業界から無視されてきました。HARAでは小規模な農場に関するこの入手困難なデータを収集し認証しているため、これらの農家はこれまでアクセスできなかったリソースにアクセスできるようになります。

HARAが作成したシステムの主なコンポーネントはブロックチェーンでできています。この技術は複数の当事者がピアツーピアネットワークを介して会話をし、中央の信頼できる機関を持たずにイミュータブルなトランザクションを記録するアプリケーションで利用されています。HARAはEthereumという人気でオープンソースなブロックチェーンプラットフォーム上で動くアプリケーションを動作させるために追加の技術を開発しなければなりませんでした。

これはNestleやSingapore Exchangeなど、多くの顧客と共有している問題です。現在ではブロックチェーン上にスケーラブルなエンタープライズアプリケーションを構築することは時間がかかり複雑です。これらの課題を解決できない組織は取り残されています。彼らのアイデアも取り残されており、HARAのような世界をよくするようなアイデアが取り残されてしまいます。

ブロックチェーンネットワークへの関連付けの複雑性を排除するために、私達は最近、スケーラブルなブロックチェーンネットワークを簡単に構築し管理できる完全にマネージドなサービスである[Amazon Managed Blockchain](https://aws.amazon.com/managed-blockchain/?nc2=h_m1)を発表しました。

さらにデータ完全性のためにブロックチェーンの同じような機能を提供する元帳データベースである[Amazon Quantum Ledger Database](https://aws.amazon.com/qldb/?nc2=h_m1) (Amazon QLDB) も公開しました。中央の信頼できる機関のある中央集権的なシステム用に設計されています。Amazon QLDBは透明性があり、不変で、中央の信頼できる機関によって保持される暗号化された検証可能なトランザクションログを提供します。

この記事ではこれらの概念とブロックチェーンを用いて構築する人々の課題、これらの問題を解決するための2つのサービスについて深く紹介します。


# ブロックチェーンと元帳技術の詳細

さて、まずブロックチェーンの背後にあるいくつかの技術を詳しくみていきましょう。元帳、合意アルゴリズム、およびスマートコントラクトです。

ブロックチェーンはデータ完全性を維持するために設計されています。それらはイミュータブルであるため、コミットされたデータの歴史を変更、または削除することはできず更新しかできません。元帳はブロックチェーンがイミュータブルであるということを用いてブロックを構築するため、これからこの概念の詳細を説明していこうとおもいます。

元帳は長い間存在しており、通常は2つ以上の当事者間の経済及び金融活動の歴史を記録するために使用されていました。メソポタミアや古代エジプトのような初期の文明でも石やパピルスを用いて元帳を使っていました。今日では貸方や借方を追跡する銀行アプリケーションが最もよく使われる元帳の例です。

ブロックチェーン (現在はAmazon QLDB) で見つかった元帳は通常次のもので構成されています。

- **現在、そして歴史的な状態** : 現在と歴史の状態値を持つデータ構造により、トランザクションログ全体をたどることなく簡単にデータへアクセスできる。
- **ジャーナル** : トランザクションログはデータ変更の全体の歴史を完全にレコードとして持っています。トランザクションログは追記のみ可能であり、つまりそれぞれの新しいレコードは以前のレコードにつながっています。そうすることでデータ変更の歴史を線形的に見ることができます。 さらに暗号化ハッシュ (各レコードに一意の識別子 (フィンガープリント) を割り当てるプロセス) を使用してブロックを互いに連鎖させます。これにより元帳にタイムキーピング属性をもたせ誰でも時間内に過去を振り返りデータトランザクションが発生したことを証明できるため監査が容易になります。

データベースは本質的には不変ではないため、顧客が監査メカニズムを設計する必要があるリレーショナルデータベースと比較してみましょう。リレーショナルデータベースにて構築されるそのような監査メカニズムはスケールすることが困難になります。それらは正しいデータがすべて記録されていることを確認するためにアプリケーション開発者に負担をかけます。

![](https://paper-attachments.dropbox.com/s_8761D74CED566C112D48E03294D242FFB05EE44458415584758C3AC8C57A24F5_1559544317327_image.png)

- L: 元帳データベース
- J: ジャーナル
- C | H: 現在 | 歴史

更にブロックチェーンのような分散元帳は、合意メカニズムとスマートコントラクトを実行する環境を含んでいます。


- **合意アルゴリズム** はネットワーク内のメンバーが元帳にトランザクションとデータをコミットするための合意手段として保証するものです。もし合意の必要性が適合しなかった場合、トランザクションはロールバックされ無効になります。
- **スマートコントラクト** は契約に対する契約の規則および罰則がコード行に定義されているプログラムです。プログラムは契約条件が満たされたときに継続的にチェックされ、契約が自動的に実行されるようにします。

これらの要素を組み合わせることで2人以上の当事者が分散信託で取引することが可能になります。各当事者はその取引に合意し、その取引を記録します。分散型の信頼は複数の組織が独立してトランザクション履歴を検証し、単一の最新で正確なデータビューを持つ必要がある場合に意味があります。アプリケーションを維持することを望んでいる単一の当事者がいないが、ネットワークメンバーが依然として他の当事者と効率的に取引したいというときにも意味があります。

![](https://www.allthingsdistributed.com/images/block2.png)


分散型の信頼が必要な貿易金融アプリケーションの例についてみてみましょう。国境をまたぐ品物の取引には輸入業者、輸出業者、複数の銀行、運送会社、保険会社、税関など多くの組織が互いに連携する必要があります。多くのステークホルダーが関わるため、信頼できる中央機関はありません。それぞれのステークホルダーは取引に関連する文書を独自に検証したいと考えており、単一の組織が活動の記録を所有することを望んでいません。

現在のプロセスでは貿易に関する事務処理 (例えば信用状など) のやり取りが必要で、完了までに5 〜 10営業日かかることがあります。これにより長い処理時間と高い費用をもたらしています。

このシナリオではステークホルダーが分散型の信頼を有効化することで効果的にコストの削減と効率性を向上することができます。ある参加者が自身でインフラストラクチャを持たず、システムが独立した検証に基づいてトランザクション元帳のコピーを各参加者へ分散します。信用状のようなビジネス契約はブロックチェーンアプリケーションにおけるスマートコントラクトとして記述されます。取引を記録するためにすべての当事者が合意をするとすぐに自動的に実行されます。

単一の信頼できる機関がなく、分散型の信頼を持つシステムが必要な場合に、顧客は複数の関係者と取引できるようにするテクノロジとしてブロックチェーンを検討します。

# Managedなブロックチェーンでブロックチェーンを簡単に

既存のフレームワークを用いてブロックチェーンを作成し運用することは難しく高価であり時間がかかるものです。まず許可を持つブロックチェーンを作成するためにはそれぞれのネットワークのメンバーが手動でハードウェアをプロビジョニングし、ソフトウェアをインストールしアクセス管理のために証明書を作成し管理し、ネットワーク構成の設定を行う必要があります。ブロックチェーンネットワークが稼働するとユーザーは継続的にインフラストラクチャを監視する必要があります。またトランザクション要求の増加やネットワーク参加、またはネットワークからの脱退などの変化に適応する必要があります。

ブロックチェーンを使うために構築する人々が直面する障壁を取り払うことを手助けするためにAWSはマネージドなブロックチェーンを作りました。自身でホストするブロックチェーンネットワークとは異なり、Amazonのマネージドなブロックチェーンは手動でのハードウェアのプロビジョニング、ソフトウェアの設定、更にネットワークやセキュリティコンポーネントの設定が不要になります。このサービスはユーザーが少しだけのクリックでスケーラブルなブロックチェーンネットワークを構成できるようになります。数百万のトランザクションを実行する数千のアプリケーション要求に合わせて自動的に拡張されます。

マネージドブロックチェーンは計算量、メモリ、ストレージ領域の使用量といったオペレーショナルメトリクスを取得でき、証明書の管理を行うことができます。マネージドブロックチェーンの投票APIによりネットワーク参加者にメンバーを追加、または削除することができます。トランザクションを検証、作成するために追加のキャパシティが必要になればメンバーはマネージドブロックチェーンAPIを用いて新しいノードを即座に追加することもできます。

さらに、マネージドブロックチェーンはCPUとメモリの様々な組み合わせを含む一連のインスタンスタイプを提供します。これによりノードをサポートするための適切なリソースの組み合わせを柔軟に選択することができます。ユーザーは使用量に応じた料金を支払い初期費用はありません。

マネージドブロックチェーンはHyperledger FabricとEthereumの2つの著名なブロックチェーンフレームワークをサポートしています。Hyperledger Fabricは厳しいプライバシーとすでにいるメンバーに対する権限管理が必要なアプリケーションに最適なものです。例えばこれには取引に関連するデータをネットワークのサブセット (取引における銀行の部分) にのみ共有したいというような金融アプリケーションが含まれるでしょう。

Ethereumはすべてのメンバーがデータ透明性を重要とするような高度に分散されたブロックチェーンネットワークに最適です。それぞれのトランザクションはネットワークに所属するすべてのメンバーが閲覧できます。例えばこれにはすべての会員に取引をブロードキャストすることによりあらゆるネットワーク小売業者がユーザーの活動を確認できるようにする顧客ロイヤルティブロックチェーンアプリケーションが含まれる場合があります。

Hyperledger Fabricマネージドブロックチェーンはすでに一般に利用可能です。(Ethereumはもうすぐリリース)

![](https://www.allthingsdistributed.com/images/block3.png)


マネージドブロックチェーンはネットワークを作成し次のようなキーコンポーネントを管理します。

- メンバー
- 各メンバーに対する Hyperledger Fabricの認証局 (CA)
- ピアノード
- 注文サービス

ブロックチェーンネットワークは分散 (decentralized) ブロックチェーンネットワークで稼働するピアツーピアネットワークです。各ネットワークは1つ以上のメンバーを含み、ネットワークには一意の識別子があります (例えば銀行コンソーシアム内の組織)。ネットワーク上の各メンバーは様々な計算能力とストレージオプションによるノードを簡単に作成することができます。

各メンバーにはHyperledger Fabric CAも作成されます。Hyperledger Fabric CAはユーザーの参加やブロックチェイン上で引き起こされるトランザクション、そしてブロックチェーン上のユーザーやコンポーネント間のTLS暗号化された接続のための証明書サービスを提供しています。

各メンバーのピアノードはHyperledger Fabricでチェインコードとして知られるスマートコントラクトを相互作用して動かします。それらはネットワークで提案された取引を作成して承認し、元帳のローカルコピーを保存します。

メンバーは自分のアプリケーションのビジネスロジックに基づいて保証プロセスのルールを定義します。例えば金融アプリケーションでの取引では、輸出当事者の銀行は取引を承認する前に輸入当事者に必要な資金があることを確認したいと考えています。ピアノード上のブロックチェーンアプリケーションを設定し、他のネットワークリソースと相互作用させるためにはメンバーがAWS CLIやSDKを用いたクライアントを利用します。これらのネットワークリソースは認証局や注文サービス、ピアノードを含みます。

マネージドブロックチェーンはこれらのサービスへのアクセスエンドポイントをもち、AWS PrivateLinkエンドポイント経由でアクセスできます。さらにマネージドブロックチェーンではデフォルトの注文サービス、つまりブロックチェーンネットワークを介したトランザクションの配信を保証するコンポーネントの信頼性を向上させました。我々はAmazon QLDBでの同じ技術を利用して注文サービスを再構築しました。ブロックチェーンネットワーク内のすべてのトランザクションの完全な履歴を正確に管理する不変の変更ログが今もあり、これによりこのデータを確実に永続的に保存することができます。

# 一元的な信頼を持つ台帳の解決策

私たちは、AWSが解決する問題をよりよく理解するために、ブロックチェーンについて顧客と話すことに多くの時間を費やしました。私達が見つけた面白いことの中には、透明性があり、不変で暗号的に検証可能な台帳が必要であるため、多くの企業がブロックチェーンに興味を持っているということがありました。しかし分散型の信頼を必要とするユースケースを持ち合わせていませんでした。

この一例として自動車の所有者と登録の歴史におけるデータの複製と自由な編集を行える方法を求める自動車部門があります。リレーショナルデータベースを用いてこの問題を解決しようとしましたが、不変属性を構築することができませんでした。ユーザーは複雑な監査機能を作成する必要がありました。また伝統的なデータベースには時間をさかのぼって変更ログの正確さを検証する手段がありませんでした。

論理的には、次の考えは「ブロックチェーンによる元帳はどうですか?」です。これはデータ整合と監査機能を解決するだけでなくさらに複数の関係者が関わるトランザクションの分散型信頼を提供できます。すべての関係者間のすべての取引について合意を必要としない企業にとってもそれは仕事に適したツールではありません。

この問題の解決策として透明性があり、不変で暗号的に検証可能なトランザクションログを持つ分散元帳があります。だからこそ、私達は専用の元帳データベースであるAmazon QLDBを作成しました。

Amazon QLDBを使用するとアプリケーションデータが時間の経過とともにどのように変化していくかを簡単に理解できるため、アプリケーション内に複雑な監査機能を構築する必要がなくなります。Amazon QLDBのジャーナルはトランザクションがデータブロックとして追加された不変なログです。トランザクションがブロックとしてジャーナルに書き込まれると変更したり削除することはできず、永久なレコードとなります。

これらのブロックは暗号 (SHA-256) を用いて互いにハッシュでつながっています。これにより、データ整合性を証明、検証することができます。(例えば、eコマース事業では落札したことの証明を示す必要があるかもしれません)。このトランザクションはCurrent Stateテーブルで更新され、常に現在のデータ値が保持されます。そして最後にトランザクションはヒストリーテーブルにインデックスされ、データが時間の経過とともにどのように変化をしたかを追跡するために問い合わせることができます。

さらに、Amazon QLDBはデータベースであるため、ブロックチェーンフレームワークよりも良いパフォーマンスとスケール性を持ち合わせています。一般的なブロックチェーンフレームワークの2倍から3倍のトランザクションを簡単にスケールアップして実行できます。Amazon QLDBは[限定プレビュー](https://pages.awscloud.com/QuantumLedgerDatabase-preview.html)として今から利用できます。

![](https://www.allthingsdistributed.com/images/block4.png)

# 現代的な元帳を誰もが利用できる

ブロックチェーンと元帳技術は多くのトランザクションタイプを劇的に向上させるポテンシャルを秘めています。しかし、誰もがアクセスできなければ多くのよい考えは実現しないでしょう。

マネージドブロックチェーンとAmazon QLDBにより、誰でも透明性を持ち、不変で暗号学的な検証性を持つ元帳を作成することができます。ブロックチェーンと元帳データベースの多くの利用例があります。ここにいくつかのサンプルがあります。

# まとめ

マネージドなブロックチェーンとAmazon QLDBという2つの解決策はあらゆるクラウドプロバイダーの中で最も幅広く奥行きのあるデータベースのAWSポートフォリオを拡張します。更に多くのオプションにより、人々の手助けになります。そして会社が仕事に最適なツールを選択する自由があるとき、それは大きな違いを生みます。

